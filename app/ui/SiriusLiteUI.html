<!DOCTYPE html>
<!--[if IE 9]><html lang="en" data-region="ea" class="lt-ie9"><![endif]-->
<!--[if !IE]><!-->
<html lang="en" data-region="ea" >
<!--<![endif]-->
<head>
    <title>TSE | Maersk | Sirius Lite</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>#main{margin-top:0 !important;} .ign-with-banner #main{margin-top:40px !important;}</style>
    <link type="text/css" href="https://www.maersk.com/Assets_sc9/Maersk/css/maeu.css?v=1.0.8118.20069" rel="stylesheet">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Corporation","@id":"https://www.maersk.com/#corporation","name":"Maersk","url":"https://www.maersk.com","logo":"https://assets.maerskline.com/integrated-global-nav/2/2.4.37//assets/img/logos/maeu.svg","description":"A.P. Moller - Maersk is an integrated logistics company. We go all the way to connect and simplify global trade for a growing world.","sameAs":["https://www.youtube.com/c/maersk","https://www.linkedin.com/company/maersk-group/","https://www.facebook.com/Maersk/","https://www.instagram.com/maersk_official/","https://twitter.com/Maersk/","https://en.wikipedia.org/wiki/Maersk"]}</script>

    <link type="text/css" href="https://assets.maerskline.com/integrated-global-nav/3/3.1.0/ign.maeu.3.1.0.css" rel="stylesheet">

    <style>
        /* CSS to set fixed height for div */
        .fixed-height-div {
            height: 650px; /* Allow the div to adjust its height based on content */
            /* max-height: 750px; Set maximum fixed height */
            overflow: auto; /* Add scrollbars if content overflows */
            border: 0px solid black; /* Optional: Add a border for visibility */
        }
        /* CSS for code snippet decoration */
        .pre_code_snippet {
            background-color: #f5f5f5;
            border-radius: 10px;
            border: 1px solid #ccc;
            counter-reset: line;
            font-family: Maersk Text,-apple-system,BlinkMacSystemFont,Microsoft JhengHei,Microsoft Yahei,微软雅黑,STXihei,华文细黑,sans-serif;
            font-size: 15px;
            line-height: 1.5;
            overflow-x: auto;
            padding: 20px;
            margin: 20px 0;
        }

        .div-with-button {
            position: relative; /* Ensure relative positioning for absolute positioning of the button */
        }

        .button-on-left {
            float: left;
        }

        .heading_Text {
            display: grid;
            place-items: center; /* Horizontally and vertically center */
            height: 200px; /* Set the height of the container */
            width: 900px;
            border: 0px solid #ccc; /* Just for visualization */
        }
    </style>
</head>
    <body class="">
        
        <!-- Header      -->
        <!-- Header ends -->

        <!-- Main -->
        <div role="main" id="main" style="opacity: 1;">
            <div class="page p-page">
                <!-- hero image style="height: 373px !important;" -->
                <div class="homepage-hero homepage-hero--active homepage-hero--staggered homepage-hero--show-gradient" data-deep-link="HomepageHero" data-r-name="Homepage Hero"  data-r-rule="true">
                    <div class="homepage-hero__container" style="padding-top: 10px !important; padding-bottom: 10px !important;" >
                        <div class="ign-header__container">        
                            <a href="/" class="ign-header__logo ign-track" data-di-id="di-id-93867d-49b7eab9">
                                <svg class="ign-logo" viewBox="0 0 170 38" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-di-res-id="3e294622-98e82a88" data-di-rand="1712130854724"><g id="Large---1280px-(Max-Width)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="IGN---Transparent" transform="translate(-104.000000, -21.000000)"><g id="IGN"><g id="Logo" transform="translate(104.000000, 21.000000)"><g id="Text" transform="translate(51.502463, 9.973333)" fill="#FFFFFF"><polyline class="ign-logo__fill" id="Fill-4" points="0.225647399 17.0377015 0.225647399 0.584446483 4.63718082 0.584446483 10.2269671 12.8797823 15.7337777 0.584446483 19.9599991 0.584446483 19.9599991 17.0377015 16.3222127 17.0377015 16.3222127 7.46604648 12.1250328 17.0377015 8.24730872 17.0377015 3.99619469 7.51820061 3.99619469 17.0377015 0.225647399 17.0377015"></polyline><path class="ign-logo__fill" d="M34.599652,10.6673492 L31.5558322,3.69310703 L28.5818502,10.6673492 L34.599652,10.6673492 Z M25.8609436,17.0377015 L21.5828626,17.0377015 L28.9365707,0.584446483 L34.2034438,0.584446483 L41.6097031,17.0377015 L37.386939,17.0377015 L35.9293352,13.7602263 L27.2736024,13.7602263 L25.8609436,17.0377015 L25.8609436,17.0377015 Z" id="Fill-5"></path><polyline class="ign-logo__fill" id="Fill-6" points="43.3155421 17.0377015 43.3155421 0.584446483 59.1445112 0.584446483 59.1445112 3.87427401 47.1386406 3.87427401 47.1386406 7.1421419 57.432449 7.1421419 57.432449 10.353052 47.1386406 10.353052 47.1386406 13.7465015 59.1735527 13.7465015 59.1735527 17.0377015 43.3155421 17.0377015"></polyline><path class="ign-logo__fill" d="M66.1296696,8.13924648 L74.4465856,8.13924648 L74.4465856,3.87427401 L66.1296696,3.87427401 L66.1296696,8.13924648 Z M62.252637,17.0377015 L62.252637,0.584446483 L75.4983007,0.584446483 C77.2677543,0.584446483 78.2952682,1.60076575 78.2952682,3.34381162 L78.2952682,8.871463 C78.2952682,10.143063 77.1605776,11.2925125 74.961034,11.2925125 C74.8365707,11.2986887 74.7093415,11.2925125 74.578655,11.2925125 L78.4342523,17.0377015 L74.1789895,17.0377015 L70.523225,11.411918 L66.1296696,11.411918 L66.1296696,17.0377015 L62.252637,17.0377015 L62.252637,17.0377015 Z" id="Fill-7"></path><path class="ign-logo__fill" d="M85.2700547,17.0473089 L83.9576581,17.0473089 C82.244213,17.0473089 81.4192977,16.0646153 81.4192977,14.633808 L81.4192977,12.4845089 L85.2700547,12.4845089 L85.2700547,13.7574813 L93.4521354,13.7574813 L93.4521354,10.3894226 C93.4521354,10.3894226 85.5646179,10.3894226 84.0669092,10.3894226 C82.5685091,10.3894226 81.4891354,9.38957309 81.4891354,8.00199878 L81.4891354,3.11735291 C81.4891354,1.63919511 82.6639309,0.594740061 84.0931848,0.594740061 C85.5217472,0.594740061 94.8219234,0.594740061 94.8219234,0.594740061 C96.2719212,0.594740061 97.2752339,1.66870336 97.2752339,3.22166116 C97.2752339,4.77256024 97.2752339,5.1849896 97.2752339,5.1849896 L93.4521354,5.1849896 L93.4521354,3.88456758 L85.2700547,3.88456758 L85.2700547,7.12498593 L94.6283138,7.12498593 C96.0098567,7.12498593 97.2752339,8.03219327 97.2752339,9.77867034 L97.2752339,14.4746006 C97.2752339,16.0742226 96.3811723,17.0473089 94.709215,17.0473089 C93.0372576,17.0473089 85.2700547,17.0473089 85.2700547,17.0473089" id="Fill-8"></path><polyline class="ign-logo__fill" id="Fill-9" points="100.970412 17.0473089 100.970412 0.592681346 104.900687 0.592681346 104.900687 7.17370887 112.387156 0.592681346 117.708655 0.592681346 108.77772 8.23600612 118.030185 17.0473089 112.520608 17.0473089 104.900687 9.56319144 104.900687 17.0473089 100.970412 17.0473089"></polyline></g><g id="Star" fill-rule="nonzero"><path d="M4.28463565,0 L31.3468062,0 C33.7169495,0 35.6383302,1.91076181 35.6383302,4.26780595 L35.6383302,33.132194 C35.6383302,35.4892382 33.7169495,37.4 31.3468062,37.4 L4.28463565,37.4 C1.91830905,37.4 0,35.4923151 0,33.1390665 L0,4.27467843 C-0.00365105909,3.142229 0.446140088,2.05490945 1.25005944,1.25285417 C2.0539788,0.450798892 3.14588678,0 4.28463565,0 Z" id="Shape" fill="#42B0D5"></path><polygon id="Shape" fill="#FFFFFF" points="23.4962889 17.6509756 30.5313476 8.91442683 30.5106156 8.88706098 20.3450249 13.7308171 17.8364529 2.84604878 17.7949889 2.84604878 15.2864169 13.7308171 5.12082631 8.88706098 5.10009431 8.91442683 12.135153 17.6509756 1.96956232 22.4947317 1.98338365 22.528939 13.2615916 22.528939 10.7530196 33.4205488 10.7806623 33.4342317 17.8157209 24.6976829 24.8507796 33.4342317 24.8853329 33.4137073 22.3698503 22.528939 33.6549689 22.528939 33.6618796 22.4947317"></polygon></g></g></g></g></g></svg> 
                            </a>
                            <div class="heading_Text">
                                <h3 class="p-section__sticky-callout__title">
                                    Welcome to Developer documentation Assistant
                                </h3>
                            </div>
                            <div class="ign-header__primary ign-header__primary--language ign-header__primary--push-l" >
                                Hey, {{ user_name }}
                                <a class="ign-footer__social__link ign-track" href="/logout" title="Logout">
                                    Logout  
                                </a>
                            </div>
                            <div class="ign-header__primary ign-header__primary--menu ign-header__primary--icon">
                                <!-- Polaris Logo starts-->                                
                                <img src="{{ url_for('ui', path='Polaris.png') }}" alt="Polaris (TSE)" style="width: 160px !important; height: 50px !important;" >
                                <!-- Polaris Logo starts-->
                            </div>
                            
                        </div>
                </div>
                <!-- hero image ends -->

                
                <!-- Chat starts-->
                <div class="p-page__section theme--light sticky--callout" data-toggle="sticky-callout" data-deep-link="StickyCallout" data-r-name="Sticky Callout" data-r-ds="Sticky Callout - Highlight">
                
                    <div class="p-page__section__outer">
                        <div class="p-page__section__inner p-page__section__inner--none">
                        
                            <div class="fixed-height-div" id="div_chat_container"> 

                                <!-- Banner Chat starts ---->
                                <div class="p-section__sticky-callout p-section__sticky-callout--with--icon" data-version="1"> 
                                    <figure class="media-image media-image--1x1 p-section__sticky-callout__icon media-image--loaded">
                                        <div class="media-image__placeholder">
                                            <img src="https://www.maersk.com/~/media_sc9/maersk/shared-files/icons/positive/industry-insights_pictogram.svg?w=1000&amp;hash=32631EFEB53FF9A0C810D9AF4B86FDCA" data-src="https://www.maersk.com/~/media_sc9/maersk/shared-files/icons/positive/industry-insights_pictogram.svg?w=1000&amp;hash=32631EFEB53FF9A0C810D9AF4B86FDCA" alt="Industry Insights" class="media-image__asset">
                                        </div>
                                        <div style="font-size: 10px; font-family: sans-serif; color: gray; ">&nbsp;</div>
                                    </figure>
                                    <div class="p-section__sticky-callout__copy">
                                        <div class="p-section__sticky-callout__text" >
                                            Welcome to the Developer Documentation portal! This interface provides a single point of entry for Maersk software developers to access information about our products with over 4.000 pages of documentation. Start by asking questions about any of our TSE developer products, then click the link to the source document in the answer if you want more information.
                                        </br>                
                                        </div>
                                        </br>
                                        <p>
                                            <button id="btn_pre_chat_1" class="button button--secondary" data-di-id="di-id-392322ef-5d4a7c05" >What is Capella?</button>
                                            &nbsp; &nbsp; &nbsp; 
                                            <button id="btn_pre_chat_2" class="button button--secondary" data-di-id="di-id-392322ef-5d4a7c05" >What can you help me with?</button> 
                                        <!-- </p>
                                        <p> -->
                                            &nbsp; &nbsp; &nbsp;
                                            <button id="btn_pre_chat_3" class="button button--secondary" data-di-id="di-id-392322ef-5d4a7c05" >What is MOP?</button>
                                            <!-- &nbsp; &nbsp; &nbsp; -->
                                            <!-- <button id="btn_pre_chat_4" class="button button--secondary" data-di-id="di-id-392322ef-5d4a7c05" >What is an Ontology dataset ?</button> -->
                                        </p>
                                    </div>
                                </div>  
                                <!-- Banner Chat ends -->

                                <!-- Chat response starts ---->
                                <div class="p-section__sticky-callout p-section__sticky-callout--with--icon" data-version="1" id="div_chat_response" style="display: none;" >  <!--  -->
                                    <figure class="media-image media-image--1x1 p-section__sticky-callout__icon media-image--loaded">
                                        <div class="media-image__placeholder">
                                            <img src="https://www.maersk.com/~/media_sc9/maersk/shared-files/icons/positive/industry-insights_pictogram.svg?w=1000&amp;hash=32631EFEB53FF9A0C810D9AF4B86FDCA" data-src="https://www.maersk.com/~/media_sc9/maersk/shared-files/icons/positive/industry-insights_pictogram.svg?w=1000&amp;hash=32631EFEB53FF9A0C810D9AF4B86FDCA" alt="Industry Insights" class="media-image__asset">
                                        </div>
                                        <div id="div_chat_response_time" style="font-size: 12px; color: gray; ">&nbsp;</div>
                                    </figure>
                                    <div class="p-section__sticky-callout__copy">
                                        <div class="p-section__sticky-callout__text"  id="div_chat_messages"  style="white-space: pre-wrap;" ></div>
                                    </div>
                                </div>  
                                <!-- Chat response ends ---->


                            </div>
                            <div class="p-section__sticky-callout p-section__sticky-callout--with--icon" data-id="{8C0C2DD3-1AEE-4F92-B1C3-F8FD00F2A1D3}" data-version="1">
                                <figure class="media-image media-image--1x1 p-section__sticky-callout__icon media-image--loaded">
                                    <div class="media-image__placeholder">
                                        <img src="https://www.maersk.com/~/media_sc9/maersk/homepage/mi-user-plus-circle-48px.svg?w=1000&amp;hash=16AD0509FD17654478205CC4CCA898F3" data-src="https://www.maersk.com/~/media_sc9/maersk/homepage/mi-user-plus-circle-48px.svg?w=1000&amp;hash=16AD0509FD17654478205CC4CCA898F3" alt="Register for a Maersk account" class="media-image__asset">
                                    </div>
                                </figure>

                            <div class="p-section__sticky-callout__copy">
                                    <h3 class="p-section__sticky-callout__title">
                                        Simply tell me what you're looking for and be as specific as possible.
                                    </h3>
                            </div>
                        </div>

                        <!--- Text Box -->
                        <div class="p-section__sticky-callout__cta">
                            <div>&nbsp;</div>
                            <input type="text" placeholder="Or ask something else?" class="form-input__field" id="txt_box_query" name="txt_box_query" autocorrect="off" autocapitalize="off" spellcheck="false" required="" >  
                            </br>
                            <button id="btn_chat" class="button button--primary" data-di-id="di-id-392322ef-5d4a7c05" >Ask</button>
                        </div>
                        <!-- Test Box ends -->

                        </div>
                    </div>
                </div>
                <!-- Chat ends-->

            </div>
        </div>        
        <!-- Main ends-->

        <!--- Footer -->
        <div class="ign-footer" id="ign-footer" style="padding-top: 30px !important; padding-bottom: 30px !important;">
            <div class="ign-footer__container">

                <!-------------->
                <div class="ign-footer__base">
                    <div class="ign-footer__copyright">
                        <a href="/" data-di-id="di-id-382af1a6-a0869d0e"><svg class="ign-logo" viewBox="0 0 170 38" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-di-res-id="92231b4-29897d9a" data-di-rand="1712236852319"><g id="Large---1280px-(Max-Width)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="IGN---Transparent" transform="translate(-104.000000, -21.000000)"><g id="IGN"><g id="Logo" transform="translate(104.000000, 21.000000)"><g id="Text" transform="translate(51.502463, 9.973333)" fill="#FFFFFF"><polyline class="ign-logo__fill" id="Fill-4" points="0.225647399 17.0377015 0.225647399 0.584446483 4.63718082 0.584446483 10.2269671 12.8797823 15.7337777 0.584446483 19.9599991 0.584446483 19.9599991 17.0377015 16.3222127 17.0377015 16.3222127 7.46604648 12.1250328 17.0377015 8.24730872 17.0377015 3.99619469 7.51820061 3.99619469 17.0377015 0.225647399 17.0377015"></polyline><path class="ign-logo__fill" d="M34.599652,10.6673492 L31.5558322,3.69310703 L28.5818502,10.6673492 L34.599652,10.6673492 Z M25.8609436,17.0377015 L21.5828626,17.0377015 L28.9365707,0.584446483 L34.2034438,0.584446483 L41.6097031,17.0377015 L37.386939,17.0377015 L35.9293352,13.7602263 L27.2736024,13.7602263 L25.8609436,17.0377015 L25.8609436,17.0377015 Z" id="Fill-5"></path><polyline class="ign-logo__fill" id="Fill-6" points="43.3155421 17.0377015 43.3155421 0.584446483 59.1445112 0.584446483 59.1445112 3.87427401 47.1386406 3.87427401 47.1386406 7.1421419 57.432449 7.1421419 57.432449 10.353052 47.1386406 10.353052 47.1386406 13.7465015 59.1735527 13.7465015 59.1735527 17.0377015 43.3155421 17.0377015"></polyline><path class="ign-logo__fill" d="M66.1296696,8.13924648 L74.4465856,8.13924648 L74.4465856,3.87427401 L66.1296696,3.87427401 L66.1296696,8.13924648 Z M62.252637,17.0377015 L62.252637,0.584446483 L75.4983007,0.584446483 C77.2677543,0.584446483 78.2952682,1.60076575 78.2952682,3.34381162 L78.2952682,8.871463 C78.2952682,10.143063 77.1605776,11.2925125 74.961034,11.2925125 C74.8365707,11.2986887 74.7093415,11.2925125 74.578655,11.2925125 L78.4342523,17.0377015 L74.1789895,17.0377015 L70.523225,11.411918 L66.1296696,11.411918 L66.1296696,17.0377015 L62.252637,17.0377015 L62.252637,17.0377015 Z" id="Fill-7"></path><path class="ign-logo__fill" d="M85.2700547,17.0473089 L83.9576581,17.0473089 C82.244213,17.0473089 81.4192977,16.0646153 81.4192977,14.633808 L81.4192977,12.4845089 L85.2700547,12.4845089 L85.2700547,13.7574813 L93.4521354,13.7574813 L93.4521354,10.3894226 C93.4521354,10.3894226 85.5646179,10.3894226 84.0669092,10.3894226 C82.5685091,10.3894226 81.4891354,9.38957309 81.4891354,8.00199878 L81.4891354,3.11735291 C81.4891354,1.63919511 82.6639309,0.594740061 84.0931848,0.594740061 C85.5217472,0.594740061 94.8219234,0.594740061 94.8219234,0.594740061 C96.2719212,0.594740061 97.2752339,1.66870336 97.2752339,3.22166116 C97.2752339,4.77256024 97.2752339,5.1849896 97.2752339,5.1849896 L93.4521354,5.1849896 L93.4521354,3.88456758 L85.2700547,3.88456758 L85.2700547,7.12498593 L94.6283138,7.12498593 C96.0098567,7.12498593 97.2752339,8.03219327 97.2752339,9.77867034 L97.2752339,14.4746006 C97.2752339,16.0742226 96.3811723,17.0473089 94.709215,17.0473089 C93.0372576,17.0473089 85.2700547,17.0473089 85.2700547,17.0473089" id="Fill-8"></path><polyline class="ign-logo__fill" id="Fill-9" points="100.970412 17.0473089 100.970412 0.592681346 104.900687 0.592681346 104.900687 7.17370887 112.387156 0.592681346 117.708655 0.592681346 108.77772 8.23600612 118.030185 17.0473089 112.520608 17.0473089 104.900687 9.56319144 104.900687 17.0473089 100.970412 17.0473089"></polyline></g><g id="Star" fill-rule="nonzero"><path d="M4.28463565,0 L31.3468062,0 C33.7169495,0 35.6383302,1.91076181 35.6383302,4.26780595 L35.6383302,33.132194 C35.6383302,35.4892382 33.7169495,37.4 31.3468062,37.4 L4.28463565,37.4 C1.91830905,37.4 0,35.4923151 0,33.1390665 L0,4.27467843 C-0.00365105909,3.142229 0.446140088,2.05490945 1.25005944,1.25285417 C2.0539788,0.450798892 3.14588678,0 4.28463565,0 Z" id="Shape" fill="#42B0D5"></path><polygon id="Shape" fill="#FFFFFF" points="23.4962889 17.6509756 30.5313476 8.91442683 30.5106156 8.88706098 20.3450249 13.7308171 17.8364529 2.84604878 17.7949889 2.84604878 15.2864169 13.7308171 5.12082631 8.88706098 5.10009431 8.91442683 12.135153 17.6509756 1.96956232 22.4947317 1.98338365 22.528939 13.2615916 22.528939 10.7530196 33.4205488 10.7806623 33.4342317 17.8157209 24.6976829 24.8507796 33.4342317 24.8853329 33.4137073 22.3698503 22.528939 33.6549689 22.528939 33.6618796 22.4947317"></polygon></g></g></g></g></g></svg></a>
                        <div class="ign-footer__copyright__text">
                            © A.P. Moller - Maersk
                        </div>
                    </div>
                    <div class="ign-footer__social">For any feedback or questions please reach out to: <a href="mailto:julian.schaefer@maersk.com">Julian Schaefer</a>, <a href="mailto:lennart.wiese@maersk.com">Lennart Wiese</a>, <a href="mailto:s.maitra@maersk.com">Shomu Maitra</a> - Team Polaris (TSE)</div>
                </div>
                <!-------------->

                </div> 
            </div>
        </div>       
        <!-- Footer ends -->

        <!-- Handle Stream -->
        <script> 
        // Copy to clip
        function copyToClipboard(id) {
            const codeSnippet = document.getElementById('pre_code_snippet_'+id);
            const text = codeSnippet.innerText;

            // Create a temporary textarea element
            const textarea = document.createElement('textarea');
            textarea.setAttribute("id", "textarea_"+id);
            textarea.value = text;
            textarea.setAttribute('readonly', '');
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';

            // Append the textarea to the body
            document.body.appendChild(textarea);

            // Select the text inside the textarea
            textarea.select();
            textarea.setSelectionRange(0, textarea.value.length);

            try {
                // Copy the selected text to the clipboard
                document.execCommand('copy');
                console.log('Text copied to clipboard');
                // Optionally, provide visual feedback to the user
            } catch (err) {
                console.error('Failed to copy text: ', err);
                // Handle errors, such as browser compatibility or permission issues
            } finally {
                // Remove the temporary textarea from the DOM
                document.body.removeChild(textarea);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {

            let startTime;
            let endTime;
            let animationInterval;

            // Create a URLSearchParams object from the current page's URL
            const queryParams = new URLSearchParams(window.location.search);
            // Get the values of specific query parameters
            const sessionId = queryParams.get("session_id"); // Retrieves the 'session_id' query parameter
            const accessToken = queryParams.get("access_token"); // Retrieves the 'access_token' query parameter

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    document.getElementById('btn_chat').click(); // Trigger click event on the button
                    document.getElementById("btn_chat").scrollIntoView({ behavior: "smooth", block: "end", inline: "nearest" });
                }
            });

            // Freeze UX
            function freezeUx() {
                startAnimation();
                document.getElementById("btn_pre_chat_1").disabled = true;
                document.getElementById("btn_pre_chat_2").disabled = true;
                document.getElementById("btn_pre_chat_3").disabled = true;
                //document.getElementById("btn_pre_chat_4").disabled = true;
                document.getElementById("btn_chat").disabled = true;
                document.getElementById("txt_box_query").disabled = true;
                // Record start time
                startTime = new Date().getTime();
                console.log("---------------------> START" )
            }

            // Unfreeze UX
            function unfreezeUx() {
                document.getElementById("btn_pre_chat_1").disabled = false;
                document.getElementById("btn_pre_chat_2").disabled = false;
                document.getElementById("btn_pre_chat_3").disabled = false;
                //document.getElementById("btn_pre_chat_4").disabled = false;
                document.getElementById("btn_chat").disabled = false;
                document.getElementById("txt_box_query").disabled = false; 
                document.getElementById("txt_box_query").value = ""
            }

            function generateRandomTwoDigitNumberAsString() {
                // Generate a random number between 10 and 99 (inclusive)
                const randomNumber = Math.floor(Math.random() * 90) + 10;
                const randomNumberAsString = randomNumber.toString(); // Convert to string
                return randomNumberAsString;
            }

            // Process code to pre tag
            function formatCodeSnippets(text) {
                // Define regular expressions for code snippets in different languages
                const javaRegex = /```java[\s\S]*?```/g;
                const pythonRegex = /```python[\s\S]*?```/g;
                const javascriptRegex = /```javascript[\s\S]*?```/g;
                const golangRegex = /```golang[\s\S]*?```/g;
                const sqlRegex = /```sql[\s\S]*?```/g;
                const dotNetRegex = /```dotnet[\s\S]*?```/g;
                const postgresRegex = /```postgres[\s\S]*?```/g;

                // Replace all occurrences of code snippets with wrapped <pre> tags
                text = text.replace(javaRegex, match => createPreCodeSnippet(match, 'java'));
                text = text.replace(pythonRegex, match => createPreCodeSnippet(match, 'python'));
                text = text.replace(javascriptRegex, match => createPreCodeSnippet(match, 'javascript'));
                text = text.replace(golangRegex, match => createPreCodeSnippet(match, 'golang'));
                text = text.replace(sqlRegex, match => createPreCodeSnippet(match, 'sql'));
                text = text.replace(dotNetRegex, match => createPreCodeSnippet(match, 'dotNet'));
                text = text.replace(postgresRegex, match => createPreCodeSnippet(match, 'postgres'));

                // Return the formatted text
                return text;
            }

            // Helper function to create a <pre> code snippet with a unique ID
            function createPreCodeSnippet(match, codeLanguage) {
                const randomId = generateRandomTwoDigitNumberAsString();
                const copyButton = `<button class="button button-group__button button--secondary button-on-left" onclick="copyToClipboard(${randomId});">Copy</button>`;
                let codeContent = match.replace(/```/g, '');
                codeContent = codeContent.replace(new RegExp(codeLanguage, 'gi'), '');
                return `<div class="div-with-button">${copyButton}<pre class="pre_code_snippet" id="pre_code_snippet_${randomId}">${codeContent}</pre></div>`;
            }

            // Update text to URL
            function replaceUrlsWithAnchorTags(inputString) {
                // Regular expression to match URLs
                const urlRegex = /\[[^\]]*\]\(([^)]+)\)/g;

                // Replace URLs with anchor tags
                const replacedString = inputString.replace(urlRegex, (match, url) => {
                    // Extract the URL and text
                    const [text, link] = match.split(/\[|\]\(|\)/).filter(Boolean);
                    // Construct the anchor tag
                    return `<a href="${link}" target="_blank">${text}</a>`;
                });

                return replacedString;
            }

            function convertBoldMarkers(text) {
                // Use a regular expression to find text between double asterisks (**)
                // and replace it with <strong> tags.
                const boldRegex = /\*\*(.*?)\*\*/g;
                return text.replace(boldRegex, '<strong>$1</strong>');
            }
            
            // Update view
            function updateView(query) {
            
                // Check if the text box value is empty
                if (query.trim() === "") {
                    alert("Please enter a query before sending.");
                    return; // Stop execution if the text box is empty
                }
                // Freeze UX
                freezeUx();
                    
                // Clone the original div
                var divContainer = document.getElementById("div_chat_container");
                var originalDiv = document.getElementById("div_chat_response");
                var divChatResponseTime = document.getElementById("div_chat_response_time"); 
                var divChatMsg = document.getElementById("div_chat_messages");
                var copiedDiv = originalDiv.cloneNode(true);
                copiedDiv.style.display = 'block'
                divContainer.appendChild(copiedDiv);
                originalDiv.removeAttribute("id");
                divChatResponseTime.removeAttribute("id");
                divChatMsg.removeAttribute("id");
                var divChatMsgCopied = document.getElementById("div_chat_messages");
                divChatMsgCopied.innerHTML = 'User: '+query + '</br> AI: ';
                var divChatResponseTimeCopied = document.getElementById("div_chat_response_time");
                divChatResponseTimeCopied.innerHTML= "";
                divChatMsgCopied.scrollIntoView({ behavior: 'smooth' }); // This will make the scrolling smooth

                // Create a FormData object to send data in a POST request
                var formData = new FormData();
                formData.append('query', query);

                // Get the current domain from the current URL
                const baseDomain = `${window.location.protocol}//${window.location.host}`;
                //console.log("Domain Name:", baseDomain);
                // Create a URL object for a specific endpoint
                const apiUrl = new URL("dify/chat", baseDomain); // Correct way to create a URL object
                apiUrl.searchParams.append("session_id", sessionId);
                apiUrl.searchParams.append("access_token", accessToken);
                console.log("URL:", apiUrl);
                const userName = "{{ user_name }}";
                const myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                const raw = JSON.stringify({
                    "inputs": {},
                    // "inputs": {
                    //     "role" : "Logistic Manager",
                    //     "Industry" : "Fashion",
                    //     "Url" : "https://www.maersk.com/transportation-services/inland-services/services",
                    //     "charaterlimit" : "150"
                    // },
                    "query": query,
                    "response_mode": "streaming",
                    "conversation_id": "",
                    "user": userName
                });

                const requestOptions = {
                    method: "POST",
                    headers: myHeaders,
                    body: raw,
                    redirect: "follow"
                };

                fetch(apiUrl, requestOptions)
                .then((response) => {
                    // Check if response is ok
                    if (!response.ok) {
                        throw new Error('Front end error: Network response was not okay');
                    }                    
                    const stream = response.body;
                    const reader = stream.getReader();
                    readStream(reader);
                })
                .catch((error) => {
                    console.error("Front end streaming error:", error);
                });
            }

            // On pre chat button 1 click
            document.getElementById("btn_pre_chat_1").addEventListener("click", function() {
                var query = this.textContent;
                document.getElementById("txt_box_query").value = query
                updateView(query);
            });
            
            // On pre chat button 2 click
            document.getElementById("btn_pre_chat_2").addEventListener("click", function() {
                var query = this.textContent;
                document.getElementById("txt_box_query").value = query
                updateView(query);
            });
            
            // On pre chat button 3 click 
            document.getElementById("btn_pre_chat_3").addEventListener("click", function() {
                var query = this.textContent;
                document.getElementById("txt_box_query").value = query
                updateView(query);
            });

            // On pre chat button 4 click 
            // document.getElementById("btn_pre_chat_4").addEventListener("click", function() {
            //     var query = this.textContent;
            //     document.getElementById("txt_box_query").value = query
            //     updateView(query);
            // });
            
            //On chat button click
            document.getElementById("btn_chat").addEventListener("click", function() {
                var query = document.getElementById("txt_box_query").value;
                updateView(query);
            });

            // Read stream
            async function readStream(reader) {
                try {
                    var divChatMessages = document.getElementById("div_chat_messages");
                    var keepTakingData = divChatMessages.innerHTML                   
                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) return;
                        //var divChatMessages = document.getElementById("div_chat_messages");
                        const info = new TextDecoder().decode(value);
                        //divChatMessages.innerHTML += info;
                        keepTakingData +=info;
                    }
                } catch (error) {
                    console.error('Error reading stream:', error);
                } finally {
                    try {
                        
                        endTime = new Date().getTime(); // Record end time
                        const duration = (endTime - startTime);
                        const delayInSeconds = Math.round(duration / 1000); // Convert milliseconds to seconds
                        startTime = null;
                        endTime = null;
                        console.log("---------------------> STOP ", duration, " second" )
                        stopAnimation();
                        
                        divChatMessages.innerHTML = formatCodeSnippets(replaceUrlsWithAnchorTags(convertBoldMarkers(keepTakingData)))
                        var divChatResponseTime = document.getElementById("div_chat_response_time");
                        divChatResponseTime.innerHTML = delayInSeconds+"s";
                    } catch (er) {
                        console.error('Error converting HTML links', er);
                    }   
                    reader.releaseLock(); // Release the reader's lock when done
                    // Unfreeze UX, ready for next operation
                    unfreezeUx();
                }
            }

        })

        function startAnimation() {
            let counter = 0;
            animationInterval = setInterval(() => {
                const dots = '*'.repeat(counter % 4);
                var divChatResponseTime = document.getElementById("div_chat_response_time");
                divChatResponseTime.innerHTML = dots;
                counter++;
            }, 500); // Adjust the interval duration as needed (500 milliseconds in this example)
        }

        function stopAnimation() {
            clearInterval(animationInterval);
        }
        </script>
        <!-- Handle Stream Ends -->
    </body>
</html>